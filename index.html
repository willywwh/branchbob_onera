<script>
  window.addEventListener("message", async (event) => {
    if (!event.data || !event.data.payload) return;

    const payload = event.data.payload;
    console.log("üì© Received payload from parent:", payload);

    try {
      const res = await fetch("https://script.google.com/macros/s/AKfycbxcGvd92-fLL1OwCLJTHtbayT4EMKLfF4nPjPHp5LrT47pPynNARp3QC3AqzrDXEXGs6w/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      console.log("‚úÖ Google Sheets response text:", text);

      const result = JSON.parse(text);
      event.source.postMessage({ hex: result.hex }, event.origin);
    } catch (e) {
      console.error("‚ùå Failed to fetch from Google Sheets:", e);
      event.source.postMessage({ error: "Failed to fetch color" }, event.origin);
    }
  });
</script>
